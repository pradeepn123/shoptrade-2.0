<script src='https://cdn.shopify.com/s/files/1/0382/4185/files/ajaxinate.js?937' defer></script>
{% paginate page.metafields.custom.works.value by 49 %}
<section class="work" data-ajax-parent>
  <div class="container">
    <h2 class="work-h1">{{ section.settings.heading }}
    </h2>
  </div>
  <div class="filter_cards container">
    <div class="filters_card_child">
      <a class="filters_switch activeWork" id="All" onclick='switchTab("workpage__card")'>
        All Work
      </a>
      
      {% assign unique_tags = page.metafields.custom.works.value | map: 'tag' | uniq %}
      {% for tag in unique_tags %}
        {% assign Ntag = tag | replace: '(', '' | replace: ')', '' | replace: '/', '' %}
          <a class="filters_switch " id="{{ Ntag }}" onclick='switchTab("{{ Ntag }}")' data-tabname = "{{  Ntag }}">
            {% assign split_tags = tag | split: ',' %}
            {% assign first_word = split_tags[0] %}
            {% assign first_words = first_word | replace: '_', '   ' %}
              {{ first_words }}
          </a>
      {% endfor %}
      {% comment %} data-active-class="{{ block.tag | replace: '(', '' | replace: ')', '' | replace: '/', '' }} {% endcomment %}
  </div>
  </div>
  <div class="workpage__cards_parent">
    <div class="container">
      <ul class="ourWork__cards workpage__cards " id="ul" data-magepow-Loop>
        {% for block in page.metafields.custom.works.value %}
          <a {% if block.make_it_as_coming_soon == false %} href="{{ block.link }}" {% endif %} {% if block.open_in_new_tab %} target="_blank" {% endif %} class="ourWork__card workpage__card {{ block.tag | replace: '(', '' | replace: ')', '' | replace: '/', '' }}" data-div>
            <div class="ourWork__cardBody">
              <div class="img-container">
                <div id="work-img-wrp" class="img-wrp">
                  <img class="thumb-img" src="{{ block.image | image_url}}" />
                  <div class="workOn-hover--info">
                   
                      {{ block.work_information | replace: ' ', '  &bull; ' }}
                    
                     <h6 class="work_info_author">
                      {{ block.brand_info }}
                    </h6> 
                  </div>
                  {% if block.show_button %}
                    <div class="btn-wrp">
                      {% if block.make_it_as_coming_soon %}
                        <a href="{{ block.link }}"
                          {% if block.open_in_new_tab %}target="_blank"{% endif %}
                          class="btn btn--arrow">
                          <div>
                            <img
                              class="btn-arrrow-work"
                              src="https://cdn.shopify.com/s/files/1/0662/5122/7356/files/WHITE-ARROW.png?v=1666071684"
                              alt="arrow" />
                          </div>
                        </a>
                      {% else %}
                        <a class="btn btn--arrow unclickble">
                          <div>
                            <img
                              class="btn-arrrow-work"
                              src="https://cdn.shopify.com/s/files/1/0662/5122/7356/files/loading-icon.svg?v=1668582566"
                              alt="arrow" />
                          </div>
                        </a>
                      {% endif %}
                    </div>
                  {% endif %}
                </div>
                {% if block.make_it_as_coming_soon %}
                  <div class="coming-soon-parent">
                    <div class="coming-soon-peoject">
                      Coming Soon
                    </div>
                  </div>
                {% endif %}
                <div class="work-logo-footer ">
                  {% if block.show_logo_insted_of_text %}
                    <div class="work-logo-footer__imgWrp">
                      <img class=" brandLogo" src=" {{ block.brand_logo | image_url}}  " />
                      {% if block.link %}
                        <span class="work_hover_arrow">
                          {% render 'arrow-icon' %}
                        </span>
                      {% endif %}
                    </div>
                  {% else %}
                    <p
                      class="work--page-brand-name {% if block.link %}work--cur-notAllow {% endif %}">
                      {{ block.brand_name }}
                      {% if block.link %}
                        <span class="work_hover_arrow">
                          {% render 'arrow-icon' %}
                        </span>
                      {% endif %}
                    </p>
                  {% endif %}
                </div>

              </div>
            </div>
          </a>
        {% endfor %}
      </ul>
    </div>
  </div>
  <div id="magepow-Pagination">
    {% if paginate.next %}
    <a href="{{ paginate.next.url }}">Loading More</a>
    {% endif %}  
  </div>
</section>
{% endpaginate %}


{% schema %}

  {
    "name": "work",
    "settings": [
      {
        "id": "heading",
        "label": "Heading",
        "type": "text"

      }
    ],

    "presets": [
      {
        "name": "works"
      }
    ]

  }
{% endschema %}

<script>

    let ul = document.getElementById("ul");
    let allcards = ul.querySelectorAll(".workpage__card");
    let div = document.querySelectorAll('[data-div]');

    function switchTab(tabname) {
      const numberOfItemsPerPage = 5;
      document.querySelector('.filters_switch.activeWork')?.classList.remove('activeWork');
      let currentActive = document.querySelector(`#${tabname}`)?.classList.add('activeWork');

      allcards.forEach(c => {
        c.style.display = "none";
      });

      let show = ul.querySelectorAll(`.${tabname}`);
      console.log('show.length', show.length);

       {% comment %} if (show.length > numberOfItemsPerPage) {
        const parentEl = document.querySelector('[data-ajax-parent]');
        if (parentEl) {
          const ajaxHtml = `<div id="magepow-Pagination">
             {% if paginate.next %}
              <a href="{{ paginate.next.url }}">Loading More</a>
              {% endif %} 
          </div>`;
          parentEl.insertAdjacentHTML('beforeend', ajaxHtml);
        }
      } {% endcomment %}

      show.forEach(c => {
          {% comment %} console.log(c) {% endcomment %}
           c.style.display = "block";
          
      });
      {% comment %} div.forEach( (r)=>{
        if(!r.classList.contains(`${tabname}`)){
          console.log('`${tabname}`',!r.classList.contains(`${tabname}`));
          r.style.display = "none";
        }
        
      }) {% endcomment %}

     console.log('tabname',tabname);


    }
    document.addEventListener("DOMContentLoaded", function () {
    var endlessScroll = new Ajaxinate({
        container: '[data-magepow-Loop]',
        pagination: '#magepow-Pagination',
        callback: function () {
         const activeTab = document.querySelector('.filters_switch.activeWork')?.dataset.tabname;
         {% comment %} console.log('activeTab',activeTab) {% endcomment %}
          switchTab(activeTab);
        }
    });
  });
</script>