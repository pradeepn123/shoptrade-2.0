
{%- comment -%}

  Liquid by Jason @ freakdesign.
  Questions? Ping me on twitter: @freakdesign

  Relates to blog post:
  http://freakdesign.com.au/blogs/news/get-the-url-querystring-values-with-liquid-in-shopify

  Example:
  https://jasons-experiments.myshopify.com/collections/all/products/3-4-sleeve-kimono-dress-coral-1?ref=freakdesign&cache=false

{%- endcomment -%}

{%- comment -%} Capture the content for header containing the tracking data {%- endcomment -%}
{%- capture contentForQuerystring -%}{{ content_for_header }}{%- endcapture -%}

{% comment %} Use string splitting to pull the value from content_for_header and apply some string clean up {% endcomment %}
{%- assign pageUrl = contentForQuerystring | split:'"pageurl":"' | last | split:'"' | first | split:'.myshopify.com' | last |
   replace:'\/','/' | 
   replace:'%20',' ' | 
   replace:'\u0026','&'
-%}
{% assign debug = false %}
{%- for i in (1..1) -%}
  {%- comment -%} If the string doesn't contain a ? then we have no querystring. Go no further {%- endcomment -%}
  {%- unless pageUrl contains "?" -%}{% break %}{%- endunless -%}

  {%- comment -%} Only work when the cache qs is used. Be aware of the perf issues with using cache=false {%- endcomment -%}
  {% comment %} {%- unless pageUrl contains "cache=false" -%}{% break %}{%- endunless -%} {% endcomment %}

  {%- comment -%} Split the url at the ? to get all values after it {%- endcomment -%}
  {%- assign pageQuerystring = pageUrl | split:'?' | last -%}

  {%- comment -%} Split the remaining string at & to get the list of keys and values (if any) {%- endcomment -%}
  {%- assign parts = pageQuerystring | split:'&' -%}
    
  {%- comment -%} Loop over them... {%- endcomment -%}
  {%- for part in parts -%}
   {% comment %} <p> {{ part }} </p> {% endcomment %}
    {%- comment -%} Split the part at the =. Not all querystrings will be in pairs so we need to account for that {%- endcomment -%}
    {%- assign keyAndValue = part | split:'=' -%}

    {%- if keyAndValue.size > 1 and forloop.first -%}
        {{ keyAndValue[1] }}

      {%- if debug -%}

        key: {{ keyAndValue[0] }}<br>
        value: {{ keyAndValue[1] }}
    
      {% endif %}
      {%- comment -%}And for an example. If the querystring key was "ref" and the value "freakdesign" do something {%- endcomment -%}
      {% comment %} {% if keyAndValue[0] == "ref" and keyAndValue[1] == "freakdesign" %}
      <p style="border: 1px solid currentColor;padding: 1em;">
        Aw Yisss! You used my special referral url. Here's a discount code <span style="background: #30ffbb;display: inline-block;font-family: monospace;padding: 0 .5em;white-space: nowrap;">sdfe-342f-234ca-343f</span>.
      </p>
      {% endif %} {% endcomment %}
    {%- else -%}
     {%- if debug -%}
      <!-- 
        value: {{ keyAndValue }}
      -->
      {%- endif -%}
    {%- endif -%}

  {%- endfor -%}
{%- endfor -%}



//////
{% assign showcaseDetails = page.metafields.custom.showcase_details.value %}

{% for item in showcaseDetails.project %}
    <div> 
    <p> {{ showcaseDetails.project }} </p>
    {% if  item.name == keyAndValue[1] %}
        
    {% endif %}


</div>
  
    {% endfor %}


<section class="showcaseBanner"> 

    <div class="container">
              
        <div class="showcaseBanner__head">
        <div class="showcaseBanner__header">
            <h1 class="h1"> {{ section.settings.heading }} </h1>
            <p class="fnt-48 clr-b"> {{ section.settings.subHeading }} </p>
        </div>
        <div class="showcaseBanner__links">
            <div class="showcaseBanner__linksItem">
                <a href="#" class="circle-link">
                    <img src='https://cdn.shopify.com/s/files/1/0662/5122/7356/files/right-up-Arrow.svg?v=1666078351' />
                </a>
                <p class="link-text">Visit site</p>
            </div>
            <div class="showcaseBanner__creditList ">
                <ul class="showcaseBanner__credit">
                    {% for item in showcaseDetails.project limit: 3 %}

                        <li class="showcaseBanner__creditItem">
                            <img src="{{ item.profile[0].profileImageUrl }}">
                        </li>
                    {%- endfor -%}
                
                </ul>
                <p class="link-text text-center">Credits</p>
                <ul class="creditDrop">
                    {% for item in showcaseDetails.project %}
                      
                        <li class="creditDrop__item">
                            <div class="creditDrop__itemImage">
                                <img src="{{ item.profile[0].profileImageUrl }}">
                            </div>
                            <div class="creditDrop__itemBody">
                                <p>{{ item.profile[0].name }}</p>
                                <p>{{ item.profile[0].designation }}</p>
                            </div>
                        </li>
                     {% endfor %}
           

                </ul>
            </div>

        </div>
    </div>
    </div>
    <div class="showcaseBanner__bannerrImage"> 
        <div class="container">
            <div class="showcaseBanner__imgWrp">
                <img class="showcaseBanner__img" src="{{ section.settings.bannerImage | image_url }}">
                <img class="showcaseBanner__logo" src='{{ section.settings.bannerImageLogo | image_url }}'>
            </div>
        </div>
    </div>
</section>

{% schema %}
{
    "name":"showcaseBanner",
    "settings":[
        {
            "id":"heading",
            "label":"Heading",
            "type":"text"
        
        },
        {
            "id":"subHeading",
            "label":"Sub Heading",
            "type":"text"
        
        },{
            "id":"bannerImage",
            "label":"Banner Image",
            "type":"image_picker"
        
        },{
            "id":"bannerImageLogo",
            "label":"Banner Logo Image",
            "type":"image_picker"
        
        }
    ],
    "blocks": [
        {
            "type": "creditProfile",
            "name": "credit profile",
            "settings": [
                {
                    "id":"profileImage",
                    "label":"profile Image",
                    "type" : "url"
                },
                {
                    "id":"profileName",
                    "label":"profile Name",
                    "type" : "text"
                },
                {
                    "id":"profileDesignation",
                    "label":"profile Designation",
                    "type" : "text"
                }
            ]
        }
    ]
    
}
{% endschema %} 